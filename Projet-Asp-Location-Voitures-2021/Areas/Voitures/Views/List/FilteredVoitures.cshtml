@using PagedList.Mvc;
@using PagedList;

@using Projet_Asp_Location_Voitures_2021.Areas.Voitures.Models

@model IPagedList<VoitureModel>




@*<div class="item_shorting clearfix" data-aos="fade-up" data-aos-delay="100" >
    <div class="row align-items-center justify-content-lg-between">
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <span class="item_available">Offres disponibles @Html.Raw(Model.Count)  </span>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div data-aos="fade-up" data-aos-delay="100">
                <button type="button" class="btn btn-info retourBtn">Retour</button>
            </div>
        </div>
    </div>
</div>
<br />
<br />*@
<div class="row">
    @if(Model.Count > 0){
        foreach (var voiture in Model)
        {
            <div class="col-lg-6 col-md-6">
                <div class="feature_vehicle_item" data-aos="fade-up" data-aos-delay="100">
                    <h3 class="item_title mb-0">
                        <a href="#!">
                            @Html.DisplayFor(modelItem => voiture.Marque)
                        </a>
                    </h3>
                    <div class="item_image position-relative">
                        <a class="image_wrap" href="@Url.Action("Index", "Details", new { id = voiture.Id })">
                            <img src=@Url.Content("~/images/" + voiture.Image_Name) alt="image_not_found">
                        </a>
                        @if (voiture.Promotion == null)
                        {
                            <span class="item_price bg_default_blue">
                                @Html.DisplayFor(modelItem => voiture.Prix) DH/Jour
                            </span>
                        }
                        else
                        {
                            <span class="item_price bg_default_blue" style="bottom: 52px!important">
                                <s>@Html.DisplayFor(modelItem => voiture.Prix) DH/Jour</s>
                            </span>
                            <span class="item_price" style="background-color: #b98200">
                                @Html.DisplayFor(modelItem => voiture.Promotion) DH/Jour
                            </span>
                        }
                        @if (voiture.DateRetour != null && voiture.DateRetour >= DateTime.Now && voiture.DateReservation <= DateTime.Now)
                        {
                            <span class="item_price bg_default_red" style="left: 70%!important">Reservé</span>
                        }
                    </div>
                    <ul class="info_list ul_li_center clearfix">
                        <li>@Html.DisplayFor(modelItem => voiture.Boite_Vitesse)</li>
                        <li>@Html.DisplayFor(modelItem => voiture.Portes) Portes</li>
                        <li>@Html.DisplayFor(modelItem => voiture.Places) Passagers</li>
                        <li>@Html.DisplayFor(modelItem => voiture.Carburant)</li>
                    </ul>
                </div>
            </div>
        }
    }
    else
    {
        <div class="col-lg-10 col-md-10" data-aos="fade-up" data-aos-delay="100">
            <h3>Aucune donnée ne correspond a votre filtre</h3>
        </div>
    }
</div>

<div class="pagination_wrap clearfix" data-aos="fade-up" data-aos-delay="100">
    <div class="row align-items-center justify-content-lg-between">
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <span class="page_number">@Html.Raw("Page " + Model.PageNumber + " / " + Model.PageCount)</span>
        </div>

        @Html.PagedListPager(Model, page => Url.Action("Index"), new PagedListRenderOptions
   {
       LiElementClasses = new string[] { "filter_trigger" },
       ContainerDivClasses = new string[] { "col-lg-6", "col-md-6", "col-sm-12", "col-xs-12" },
       UlElementClasses = new string[] { "pagination_nav", "ul_li_right", "clearfix" },
       
   })
        @*<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <ul class="pagination_nav ul_li_right clearfix">
                    <li><a href="#!"><i class="fal fa-angle-double-left"></i></a></li>
                    <li class="active"><a href="#!">1</a></li>
                    <li><a href="#!">2</a></li>
                    <li><a href="#!">3</a></li>
                    <li><a href="#!"><i class="fal fa-angle-double-right"></i></a></li>
                </ul>
            </div>*@
    </div>
</div>

<script type="text/javascript">


    $('.filter_trigger').click(function (e) {

        e.preventDefault();
        e.stopPropagation();
        let Elempage = $(this)[0].firstChild.innerText;
        let pageNumber = Number.parseInt(Elempage);

        if (!Number.isInteger(pageNumber)) {
            let LiElemLink = $('li.filter_trigger.active');

            if ($(this)[0].nextSibling != null) {
                pageNumber = Number.parseInt(LiElemLink[0].previousSibling.innerText);
            } else {
                pageNumber = Number.parseInt(LiElemLink[0].nextSibling.innerText);
            }
        }

        let json = {
            page: pageNumber,
            passagers: $('input[name=passagers]:checked').val(),
            portes: $('input[name=portes]:checked').val(),
            prix: $('#Prix').val(),
            carburant: $('#Carburant').val(),
            marque: $('#Marque').val(),
            boite_vitesse: $('#Boite_Vitesse').val(),
            date: $('input[name=date]').val(),
            location: $('input[name=location]').val()
        };

        URL = "FilteredVoitures";

        if (window.location.href.indexOf('?') > -1) {
            URL = "List/FilteredVoitures";
        }

        $.ajax({
            url: URL,
            type: "POST",
            dataType: "html",
            data: json,
            success: function (data) {
                //var message = data.Message;
                $("html,body").animate({
                    scrollTop: $("#thetop").offset().top
                }, "slow");

                $('#VoituresContainer').html(data);
            },
            error: function (err) {
                $('#VoituresContainer').html(err.responseText);
            }
        })

    });

    $('#filterSidePanel').hide(1000);
    $('#filterSidePanel2_h6').text('Offres disponibles ' + @Html.Raw(Model.TotalItemCount));
    setTimeout(function () {
        $('#filterSidePanel2').show(1000);
    }, 1000);

    $('#retourBtn').click(function () {
        location.reload();
    });
</script>